<ng-template #modalCancelaReserva let-modal>
  <div class="modal-body">
    <div class="d-flex justify-content-between">
      <h4 class="modal-title text-dark-blue text-center">
        Você realmente deseja cancelar essa reserva?
      </h4>
    </div>

    <div class="d-block d-md-flex mt-3 mb-2">
      <div class="col-12 col-md-6 me-0 me-md-2 mb-2 mb-md-0 pe-2">
        <app-btn-green
          [textButton]="'Confirmar'"
          [showIcon]="true"
          [iconFirst]="true"
          [icone]="faConfirm"
          (emmiterClick)="cancelarReserva()"
        ></app-btn-green>
      </div>

      <div class="col-12 col-md-6 pe-2">
        <app-btn-red
          [textButton]="'Cancelar'"
          [showIcon]="true"
          [iconFirst]="true"
          [icone]="faCancel"
          (emmiterClick)="closeModal()"
        ></app-btn-red>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #modalConfirmarUso let-modal>
  <div class="modal-body">
    <div class="d-flex justify-content-between">
      <h4 class="modal-title text-dark-blue text-center">
        Você realmente deseja confirmar que fez o uso desta reserva?
      </h4>
    </div>

    <div class="d-block d-md-flex mt-3 mb-2">
      <div class="col-12 col-md-6 me-0 me-md-2 mb-2 mb-md-0 pe-2">
        <app-btn-green
          [textButton]="'Confirmar'"
          [showIcon]="true"
          [iconFirst]="true"
          [icone]="faConfirm"
          (emmiterClick)="confirmarReserva()"
        ></app-btn-green>
      </div>

      <div class="col-12 col-md-6 pe-2">
        <app-btn-red
          [textButton]="'Cancelar'"
          [showIcon]="true"
          [iconFirst]="true"
          [icone]="faCancel"
          (emmiterClick)="closeModal()"
        ></app-btn-red>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #modalDetalhes let-modal>
  <div class="modal-body">
    <div class="text-end">
      <button class="btn-close-modal text-dark-blue" (click)="closeModal()">
        <fa-icon [icon]="faCancel"></fa-icon>
      </button>
    </div>

    <div>
      <h4 class="modal-title text-green text-center">Detalhes da reserva</h4>
    </div>

    <div class="row w-100 mt-3">
      <div class="col-12 col-md-8 my-1">
        <strong>Data e horário da solicitação: </strong>
        <span>
          {{ dadosReserva?.dataHoraSolicitacao | date : "dd/MM/yyyy - HH:mm" }}
        </span>
      </div>

      <div class="col-12 col-md-4 my-1">
        <strong>Numero da reserva: </strong><span>{{ dadosReserva?.id }} </span>
      </div>

      <div class="col-12 col-md-4 my-1">
        <strong>Local: </strong
        ><span
          >{{ getNomeLocal(dadosReserva?.idEspacoEsportivo!) | titlecase }}
        </span>
      </div>

      <div class="col-12 col-md-8 my-1">
        <strong>Data e horário da reserva: </strong>
        <span
          >{{
            dadosReserva?.dataHoraInicioReserva | date : "dd/MM/yyyy - HH:mm"
          }}
          às {{ dadosReserva?.dataHoraFimReserva | date : "HH:mm" }}</span
        >
      </div>

      <div class="col-12 col-md-6 my-1">
        <strong>Status: </strong>
        <span>{{ statusToString(dadosReserva?.status!) | titlecase }}</span>
      </div>

      <div class="col-12 col-md-6 my-1">
        <strong>Quantidade de participantes: </strong>
        <span>{{ dadosReserva?.qtdParticipantes }} pessoas</span>
      </div>

      <div class="col-12 my-1">
        <strong>Objetivo da solicitação </strong>
        <span>{{ dadosReserva?.motivoSolicitacao }}</span>
      </div>

      <div class="col-12 my-1" *ngIf="dadosReserva?.motivoCancelamento">
        <strong>Motivo para negação da reserva: </strong>
        <span>{{ dadosReserva?.motivoCancelamento }}</span>
      </div>
    </div>
  </div>
</ng-template>

<ngx-ui-loader [loaderId]="'loader-01'"></ngx-ui-loader>

<div class="mx-3 mt-4">
  <h3 class="text-green font-weight-bold mb-3">Histórico de Solicitações</h3>
  <form [formGroup]="formFiltros">
    <div class="row w-100">
      <div class="col-12 col-md-2">
        <app-input-date
          [formGroup]="formFiltros"
          [controlName]="'dataInicial'"
          [label]="'Data inicial'"
          (emitterChange)="filterReservas()"
        ></app-input-date>
      </div>

      <div class="col-12 col-md-2">
        <app-input-date
          [formGroup]="formFiltros"
          [controlName]="'dataFinal'"
          [label]="'Data final'"
          (emitterChange)="filterReservas()"
        ></app-input-date>
      </div>

      <div class="col-12 col-md-2">
        <app-input-select-option
          [formGroup]="formFiltros"
          [controlName]="'local'"
          [label]="'Local'"
          [items]="locais"
          (emitterChange)="filterReservas()"
        ></app-input-select-option>
      </div>

      <div class="col-12 col-md-2">
        <app-input-select-option
          [formGroup]="formFiltros"
          [controlName]="'status'"
          [label]="'Status das reserva'"
          [items]="statusReservas"
          (emitterChange)="filterReservas()"
        ></app-input-select-option>
      </div>

      <div
        class="col-12 col-md-3 mt-4"
        *ngIf="
          minhasReservasFilter != null && minhasReservasFilter != undefined
        "
      >
        <app-btn-green
          [textButton]="'Limpar filtros'"
          [showIcon]="true"
          [icone]="faFilterRemove"
          (emmiterClick)="limparFiltros()"
        ></app-btn-green>
      </div>
    </div>
  </form>

  <div class="d-flex justify-content-end">
    <app-btn-green
      [showIcon]="true"
      [icone]="faAdd"
      [textButton]="'Nova reserva'"
      (emmiterClick)="novaReserva()"
    ></app-btn-green>
  </div>

  <ng-container
    *ngIf="
      minhasReservasFilter != null && minhasReservasFilter != undefined;
      else semFiltro
    "
  >
    <div class="table-content mt-2">
      <div class="text-center" *ngIf="minhasReservasFilter?.length! > 5">
        <pagination-controls
          (pageChange)="p = $event"
          previousLabel="<"
          nextLabel=">"
        ></pagination-controls>
      </div>

      <div class="table-scroll">
        <div
          class="h-100 d-flex align-items-center justify-content-center"
          *ngIf="minhasReservasFilter?.length == 0; else reservas"
        >
          <h3 class="text-dark-blue text-center">
            Nenhuma reserva foi encontranda com esses filtros :(
          </h3>
        </div>

        <ng-template #reservas>
          <table class="table">
            <thead>
              <tr class="text-center">
                <th scope="col">Espaço</th>
                <th colspan="999" scope="col">Data e Horário</th>
                <th scope="col">Status</th>
                <th scope="col">Ações</th>
              </tr>
            </thead>

            <tbody>
              <tr
                class="text-center"
                *ngFor="
                  let r of minhasReservasFilter
                    | paginate : { itemsPerPage: 5, currentPage: p }
                "
              >
                <td>
                  <p class="mb-0 mt-2">
                    {{ getNomeLocal(r.idEspacoEsportivo!) | titlecase }}
                  </p>
                </td>

                <td colspan="999">
                  <p class="mb-0 mt-2">
                    {{ r.dataHoraInicioReserva | date : "dd/MM/yyyy - HH:mm" }}
                    às
                    {{ r.dataHoraFimReserva | date : "HH:mm" }}
                  </p>
                </td>

                <td>
                  <p class="mb-0 mt-2">
                    {{ statusToString(r.status!) | titlecase }}
                  </p>
                </td>

                <td>
                  <div class="d-flex justify-content-center">
                    <div class="me-2">
                      <app-btn-border-green
                        [showIcon]="true"
                        [icone]="faEye"
                        [textButton]="'Detalhes'"
                        (emmiterClick)="
                          openModalConfirmacao(modalDetalhes, r.id!, 'lg', r)
                        "
                      ></app-btn-border-green>
                    </div>

                    <div
                      class="me-2"
                      *ngIf="
                        showConfirmacaoReserva(
                          r.dataHoraInicioReserva!,
                          r.status!
                        )
                      "
                    >
                      <app-btn-green
                        [showIcon]="true"
                        [icone]="faConfirm"
                        [textButton]="'Usei'"
                        (emmiterClick)="
                          openModalConfirmacao(modalConfirmarUso, r.id!)
                        "
                      ></app-btn-green>
                    </div>

                    <div>
                      <app-btn-red
                        [showIcon]="true"
                        [icone]="faCancel"
                        [textButton]="'Cancelar'"
                        (emmiterClick)="
                          openModalConfirmacao(modalCancelaReserva, r.id!)
                        "
                      ></app-btn-red>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-template>
      </div>
    </div>
  </ng-container>

  <ng-template #semFiltro>
    <div class="table-content mt-2">
      <div class="text-center" *ngIf="minhasReservas?.length! > 5">
        <pagination-controls
          (pageChange)="p = $event"
          previousLabel="<"
          nextLabel=">"
        ></pagination-controls>
      </div>

      <div class="table-scroll">
        <div
          class="h-100 d-flex align-items-center justify-content-center"
          *ngIf="minhasReservas?.length == 0; else reservas"
        >
          <h3 class="text-dark-blue text-center">
            Nenhuma reserva foi feita até o momento :(
          </h3>
        </div>

        <ng-template #reservas>
          <table class="table">
            <thead>
              <tr class="text-center">
                <th scope="col">Espaço</th>
                <th colspan="999" scope="col">Data e Horário</th>
                <th scope="col">Status</th>
                <th scope="col">Ações</th>
              </tr>
            </thead>

            <tbody>
              <tr
                class="text-center"
                *ngFor="
                  let r of minhasReservas
                    | paginate : { itemsPerPage: 5, currentPage: p }
                "
              >
                <td>
                  <p class="mb-0 mt-2">
                    {{ getNomeLocal(r.idEspacoEsportivo!) | titlecase }}
                  </p>
                </td>

                <td colspan="999">
                  <p class="mb-0 mt-2">
                    {{ r.dataHoraInicioReserva | date : "dd/MM/yyyy - HH:mm" }}
                    às
                    {{ r.dataHoraFimReserva | date : "HH:mm" }}
                  </p>
                </td>

                <td>
                  <p class="mb-0 mt-2">
                    {{ statusToString(r.status!) | titlecase }}
                  </p>
                </td>

                <td>
                  <div class="d-flex justify-content-center">
                    <div class="me-2">
                      <app-btn-border-green
                        [showIcon]="true"
                        [icone]="faEye"
                        [textButton]="'Detalhes'"
                        (emmiterClick)="
                          openModalConfirmacao(modalDetalhes, r.id!, 'lg', r)
                        "
                      ></app-btn-border-green>
                    </div>

                    <div
                      class="me-2"
                      *ngIf="
                        showConfirmacaoReserva(
                          r.dataHoraInicioReserva!,
                          r.status!
                        )
                      "
                    >
                      <app-btn-green
                        [showIcon]="true"
                        [icone]="faConfirm"
                        [textButton]="'Usei'"
                        (emmiterClick)="
                          openModalConfirmacao(modalConfirmarUso, r.id!)
                        "
                      ></app-btn-green>
                    </div>

                    <div>
                      <app-btn-red
                        [showIcon]="true"
                        [icone]="faCancel"
                        [textButton]="'Cancelar'"
                        (emmiterClick)="
                          openModalConfirmacao(modalCancelaReserva, r.id!)
                        "
                      ></app-btn-red>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-template>
      </div>
    </div>
  </ng-template>
</div>
